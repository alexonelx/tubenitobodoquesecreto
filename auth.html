<!doctype html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acceso ‚Ä¢ Tu Benito Bodoque Secreto</title>

  <!-- Favicons (mismas rutas que tu proyecto) -->
  <link rel="icon" href="./favicon.ico">
  <link rel="icon" href="./images/icons/favicon.ico?v=7">
  <link rel="icon" type="image/png" sizes="32x32" href="./images/icons/favicon-32x32.png?v=7">
  <link rel="apple-touch-icon" sizes="180x180" href="./images/icons/apple-touch-icon.png?v=7">
  <link rel="manifest" href="./images/icons/site.webmanifest">
  <meta name="theme-color" content="#0b1020">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      color-scheme: dark;
      --bg:#0b1020;
      --panel:#0f1730;
      --text:#eef2ff;
      --muted:#9aa7c7;
      --line:rgba(255,255,255,.12);
      --radius:18px;
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --max: 1040px;
      --headerA: rgba(11,16,32,.82);
      --headerB: rgba(11,16,32,.30);
      --t:.18s ease;
    }
    html[data-theme="light"]{
      color-scheme: light;
      --bg:#f6f8ff;
      --panel:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:rgba(15,23,42,.12);
      --shadow:0 18px 50px rgba(15,23,42,.10);
      --headerA: rgba(246,248,255,.90);
      --headerB: rgba(246,248,255,.60);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% -10%, rgba(78,166,255,.14), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(255,77,90,.10), transparent 55%),
        var(--bg);
      overflow-x:hidden;
      transition: background var(--t), color var(--t);
    }
    a{color:inherit;text-decoration:none}
    button,input{font:inherit}
    :focus-visible{ outline: 3px solid rgba(78,166,255,.55); outline-offset: 3px; border-radius: 12px; }
    .wrap{max-width:var(--max);margin:0 auto;padding:18px 18px 80px;}

    header{
      position: sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, var(--headerA), var(--headerB));
      border-bottom: 1px solid var(--line);
    }
    .nav{
      max-width:var(--max); margin:0 auto;
      padding:12px 18px;
      display:flex; align-items:center; gap:12px;
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:0;flex:1 1 auto;}
    .logoBox{width:48px;height:48px;border-radius:16px;display:grid;place-items:center;overflow:hidden;flex:0 0 auto;}
    .logoBox img{width:100%;height:100%;object-fit:contain;filter: drop-shadow(0 6px 14px rgba(0,0,0,.35));}
    .brandName{font-weight:900;letter-spacing:-.6px;font-size:18px;line-height:1.05;max-width:30ch;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .menu{display:flex;align-items:center;gap:10px;flex:0 0 auto;}
    .themeToggle{
      width:42px;height:42px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.06);color:var(--text);
      display:grid;place-items:center;cursor:pointer;
      transition: transform var(--t), background var(--t), border-color var(--t);
    }
    .themeToggle:hover{transform:translateY(-1px);}
    .cta{
      padding:10px 12px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.06);font-weight:800;white-space:nowrap;
    }
    .ctaPrimary{border:none;background:linear-gradient(135deg, rgba(255,77,90,.92), rgba(78,166,255,.86));}

    .panel{
      margin-top:26px;
      border:1px solid var(--line);
      border-radius: calc(var(--radius) + 8px);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
      background:
        radial-gradient(600px 240px at 20% 0%, rgba(78,166,255,.10), transparent 60%),
        radial-gradient(600px 240px at 80% 0%, rgba(255,77,90,.08), transparent 60%);
      opacity:.9;
    }
    .panel > *{position:relative;}
    .block{padding:28px;display:grid;gap:18px;grid-template-columns:1fr;}

    h1{margin:0;letter-spacing:-1px;font-weight:900;font-size:clamp(28px,6vw,44px);line-height:1.06;}
    .sub{margin:8px 0 0;color:var(--muted);font-size:15px;line-height:1.75;max-width:66ch;}

    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
    .tab{
      padding:10px 12px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.03);color:var(--muted);font-weight:900;cursor:pointer;
    }
    .tab.active{background:rgba(255,255,255,.06);color:var(--text);}

    .grid{display:grid;gap:10px;margin-top:10px;}
    .label{font-size:13px;color:var(--muted);font-weight:800;margin-top:4px;}
    .input{
      width:100%;
      padding:12px;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.04);color:var(--text);outline:none;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:8px;}
    .btn{
      padding:12px 14px;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.06);color:var(--text);font-weight:900;cursor:pointer;
    }
    .btnPrimary{
      border:none;background:linear-gradient(135deg, rgba(255,77,90,.92), rgba(78,166,255,.86));
    }
    .hint{margin:10px 0 0;color:var(--muted);font-size:13px;line-height:1.45;min-height:18px;}
    .hint.ok{color:rgba(110,231,183,.95);}
    .hint.bad{color:rgba(248,113,113,.95);}
    .hidden{display:none !important;}

    .banner{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding: 12px;
      color: var(--muted);
      font-weight: 800;
      font-size: 13px;
      line-height: 1.5;
    }

    @media (max-width: 720px){
      .brandName{font-size:16px;white-space:normal;overflow:visible;text-overflow:unset;}
    }
  </style>
</head>

<body>
  <header>
    <div class="nav">
      <div class="brand">
        <div class="logoBox" aria-hidden="true">
          <img src="images/LogoBenitopng.png" alt="">
        </div>
        <div class="brandName">Tu Benito Bodoque Secreto</div>
      </div>

      <div class="menu">
        <button class="themeToggle" id="themeToggle" type="button" aria-label="Cambiar tema">‚òÄÔ∏è</button>
        <a class="cta" href="index.html">Volver</a>
        <a class="cta ctaPrimary" href="dashboard.html" id="goDashboard" style="display:none;">Ir a familias</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="panel">
      <div class="block">
        <div>
          <h1>Acceso</h1>
          <p class="sub">Reg√≠strate para unirte por link o inicia sesi√≥n. Luego te mando a la p√°gina de familias.</p>
        </div>

        <div class="banner" id="inviteBanner" style="display:none;"></div>

        <div class="tabs" role="tablist" aria-label="Acceso">
          <button class="tab active" id="tabLogin" type="button" role="tab" aria-selected="true">Iniciar sesi√≥n</button>
          <button class="tab" id="tabSignup" type="button" role="tab" aria-selected="false">Registrarse</button>
        </div>

        <!-- LOGIN -->
        <form class="grid" id="loginForm" autocomplete="on">
          <label class="label">Usuario o tel√©fono</label>
          <input class="input" id="loginId" placeholder="Ej: alex_99 o 9981234567" required>

          <label class="label">Contrase√±a</label>
          <input class="input" type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>

          <div class="row">
            <button class="btn btnPrimary" type="submit">Entrar</button>
          </div>
          <p class="hint" id="loginMsg" aria-live="polite"></p>
        </form>

        <!-- SIGNUP PASO 1 -->
        <form class="grid hidden" id="signupForm" autocomplete="on">
          <label class="label">Nombre de usuario</label>
          <input class="input" id="signupUser" placeholder="Ej: alex_99" minlength="2" maxlength="18" required>

          <label class="label">Tel√©fono (WhatsApp)</label>
          <input class="input" id="signupPhone" placeholder="Ej: 9981234567" inputmode="numeric" required>

          <label class="label">Contrase√±a</label>
          <input class="input" type="password" id="signupPass" placeholder="M√≠nimo 6 caracteres" minlength="6" required>

          <label class="label">Confirmar contrase√±a</label>
          <input class="input" type="password" id="signupPass2" placeholder="Repite tu contrase√±a" minlength="6" required>

          <div class="row">
            <button class="btn btnPrimary" type="submit">Continuar</button>
          </div>
          <p class="hint" id="signupMsg" aria-live="polite"></p>
        </form>

        <!-- SIGNUP PASO 2 -->
        <form class="grid hidden" id="profileForm" autocomplete="on">
          <label class="label">Tu nombre</label>
          <input class="input" id="profileName" placeholder="Ej: Alexis" minlength="2" maxlength="40" required>

          <div class="row">
            <button class="btn btnPrimary" type="submit">Terminar</button>
            <button class="btn" type="button" id="backToSignup">Atr√°s</button>
          </div>
          <p class="hint" id="profileMsg" aria-live="polite"></p>
          <p class="hint" style="margin-top:6px;">(La foto se agrega en ‚ÄúMi cuenta‚Äù en el dashboard.)</p>
        </form>
      </div>
    </section>
  </main>

  <script>
    // ===== THEME =====
    const root = document.documentElement;
    const themeToggle = document.getElementById("themeToggle");

    function setTheme(theme){
      root.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
      themeToggle.textContent = (theme === "dark") ? "‚òÄÔ∏è" : "üåô";
      document.querySelector('meta[name="theme-color"]')?.setAttribute("content", theme === "dark" ? "#0b1020" : "#f6f8ff");
    }
    setTheme(localStorage.getItem("theme") || "dark");
    themeToggle.addEventListener("click", ()=>{
      setTheme((root.getAttribute("data-theme") || "dark") === "dark" ? "light" : "dark");
    });

    // ===== STORAGE =====
    function getUsers(){ try{ return JSON.parse(localStorage.getItem("bb_users") || "[]"); }catch{ return []; } }
    function setUsers(users){ localStorage.setItem("bb_users", JSON.stringify(users)); }
    function setSession(session){ localStorage.setItem("bb_session", JSON.stringify(session)); }
    function getSession(){ try{ return JSON.parse(localStorage.getItem("bb_session") || "null"); }catch{ return null; } }

    function cleanPhone(raw){ return (raw || "").replace(/\D/g, ""); }
    function validPhoneMX(p){ return /^\d{10}$/.test(p); }
    function validUsername(u){ return /^[a-zA-Z0-9_.]{2,18}$/.test(u); }
    function msg(el, text, ok){
      if(!el) return;
      el.textContent = text || "";
      el.classList.remove("ok","bad");
      if(text) el.classList.add(ok ? "ok" : "bad");
    }

    // ===== INVITE SUPPORT (?grupo=XXXX) =====
    const inviteBanner = document.getElementById("inviteBanner");
    const params = new URLSearchParams(location.search);
    const inviteCode = (params.get("grupo") || "").trim().toUpperCase();
    if(inviteCode){
      localStorage.setItem("bb_invite_group", inviteCode);
      inviteBanner.style.display = "block";
      inviteBanner.textContent = `Vas a unirte al grupo ${inviteCode}. Primero inicia sesi√≥n o reg√≠strate.`;
    }

    // If already logged in, show quick button
    const goDashboard = document.getElementById("goDashboard");
    if(getSession()){
      goDashboard.style.display = "inline-block";
    }

    // ===== TABS =====
    const tabLogin = document.getElementById("tabLogin");
    const tabSignup = document.getElementById("tabSignup");
    const loginForm = document.getElementById("loginForm");
    const signupForm = document.getElementById("signupForm");
    const profileForm = document.getElementById("profileForm");
    const backToSignup = document.getElementById("backToSignup");

    function showLogin(){
      tabLogin.classList.add("active");
      tabSignup.classList.remove("active");
      tabLogin.setAttribute("aria-selected","true");
      tabSignup.setAttribute("aria-selected","false");
      loginForm.classList.remove("hidden");
      signupForm.classList.add("hidden");
      profileForm.classList.add("hidden");
    }
    function showSignupStep1(){
      tabSignup.classList.add("active");
      tabLogin.classList.remove("active");
      tabSignup.setAttribute("aria-selected","true");
      tabLogin.setAttribute("aria-selected","false");
      loginForm.classList.add("hidden");
      signupForm.classList.remove("hidden");
      profileForm.classList.add("hidden");
    }
    function showSignupStep2(){
      loginForm.classList.add("hidden");
      signupForm.classList.add("hidden");
      profileForm.classList.remove("hidden");
    }

    tabLogin.addEventListener("click", showLogin);
    tabSignup.addEventListener("click", showSignupStep1);
    backToSignup.addEventListener("click", ()=>{ showSignupStep1(); });

    // ===== SIGNUP (2 pasos) =====
    let pendingSignup = null;

    signupForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const username = document.getElementById("signupUser").value.trim();
      const phone = cleanPhone(document.getElementById("signupPhone").value);
      const pass = document.getElementById("signupPass").value;
      const pass2 = document.getElementById("signupPass2").value;
      const out = document.getElementById("signupMsg");

      if(!validUsername(username)) return msg(out, "Usuario inv√°lido. Usa letras/n√∫meros/_/. (2‚Äì18).", false);
      if(!validPhoneMX(phone)) return msg(out, "Tel√©fono inv√°lido. Debe ser de 10 d√≠gitos (MX).", false);
      if(pass.length < 6) return msg(out, "Contrase√±a muy corta (m√≠nimo 6).", false);
      if(pass !== pass2) return msg(out, "Las contrase√±as no coinciden.", false);

      const users = getUsers();
      if(users.some(u => (u.username || "").toLowerCase() === username.toLowerCase()))
        return msg(out, "Ese usuario ya existe.", false);
      if(users.some(u => u.phone === phone))
        return msg(out, "Ese tel√©fono ya est√° registrado.", false);

      pendingSignup = { username, phone, pass };
      msg(out, "Listo. Ahora dime tu nombre.", true);
      showSignupStep2();
      document.getElementById("profileName").focus();
    });

    profileForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const out = document.getElementById("profileMsg");
      const name = document.getElementById("profileName").value.trim();
      if(!pendingSignup) return msg(out, "Algo fall√≥. Vuelve a registrarte.", false);
      if(name.length < 2) return msg(out, "Nombre inv√°lido.", false);

      const users = getUsers();
      const user = { ...pendingSignup, name, photo: null, createdAt: Date.now() };
      users.push(user);
      setUsers(users);

      setSession({ username: user.username, phone: user.phone, name: user.name, at: Date.now() });
      msg(out, "Perfecto. Entrando‚Ä¶", true);

      // si ven√≠as por invitaci√≥n, el dashboard har√° el auto-join
      setTimeout(()=>{ window.location.href = "dashboard.html"; }, 350);
    });

    // ===== LOGIN =====
    loginForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const id = (document.getElementById("loginId").value || "").trim();
      const pass = document.getElementById("loginPass").value;
      const out = document.getElementById("loginMsg");

      if(!id || !pass) return msg(out, "Completa tus datos.", false);

      const users = getUsers();
      const phone = cleanPhone(id);
      const byPhone = validPhoneMX(phone);

      const user = users.find(u => (byPhone ? u.phone === phone : (u.username || "").toLowerCase() === id.toLowerCase()) && u.pass === pass);
      if(!user) return msg(out, "Datos incorrectos.", false);

      setSession({ username: user.username, phone: user.phone, name: user.name || "", at: Date.now() });
      msg(out, `Bienvenido, ${user.username}.`, true);

      setTimeout(()=>{ window.location.href = "dashboard.html"; }, 200);
    });

    // default tab
    showLogin();
  </script>
</body>
</html>
